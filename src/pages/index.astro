---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getCollection } from 'astro:content';

const posts = (await getCollection('digest'))
  .filter(post => !post.data.isHidden)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const [featuredPost, ...otherPosts] = posts;
---

<!doctype html>
<html lang="ru">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      .hero {
        margin-bottom: var(--space-5xl);
        padding: var(--space-4xl) 0;
        border-bottom: 3px solid rgb(var(--black));
      }

      .hero__title {
        font-size: var(--text-5xl);
        font-weight: 900;
        line-height: 0.9;
        margin: 0 0 var(--space-xl) 0;
        letter-spacing: -0.05em;
        text-transform: uppercase;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: fadeIn 0.8s var(--transition-base);
      }

      .hero__subtitle {
        font-size: var(--text-xl);
        color: rgb(var(--gray-dark));
        max-width: 50ch;
        line-height: 1.4;
        margin: 0;
        font-weight: 400;
      }

      .featured {
        margin-bottom: var(--space-5xl);
        position: relative;
      }

      .featured__label {
        display: inline-block;
        font-size: var(--text-xs);
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: rgb(var(--white));
        background: rgb(var(--black));
        padding: var(--space-xs) var(--space-md);
        margin-bottom: var(--space-lg);
        border: 3px solid rgb(var(--black));
        box-shadow: 4px 4px 0 var(--accent);
      }

      .featured__card {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-2xl);
        padding: var(--space-3xl);
        background: rgb(var(--white));
        border: 4px solid rgb(var(--black));
        box-shadow: var(--shadow-brutal);
        position: relative;
        transition: all var(--transition-base);
      }

      .featured__card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: var(--gradient-primary);
      }

      .featured__card:hover {
        transform: translate(4px, 4px);
        box-shadow: 4px 4px 0 rgb(var(--black));
      }

      .featured__content {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
      }

      .featured__title {
        font-size: var(--text-3xl);
        font-weight: 900;
        line-height: 1;
        margin: 0;
        color: rgb(var(--black));
        letter-spacing: -0.03em;
      }

      .featured__date {
        font-size: var(--text-sm);
        color: rgb(var(--gray));
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0;
      }

      .featured__description {
        font-size: var(--text-lg);
        line-height: 1.6;
        color: rgb(var(--gray-dark));
        margin: 0;
      }

      .featured__link {
        display: inline-flex;
        align-items: center;
        gap: var(--space-sm);
        font-size: var(--text-base);
        font-weight: 700;
        color: rgb(var(--white));
        background: var(--accent);
        padding: var(--space-md) var(--space-xl);
        border: 3px solid rgb(var(--black));
        box-shadow: 4px 4px 0 rgb(var(--black));
        text-transform: uppercase;
        letter-spacing: 0.05em;
        align-self: flex-start;
        transition: all var(--transition-fast);
      }

      .featured__link:hover {
        background: var(--accent-dark);
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0 rgb(var(--black));
      }

      .featured__link-arrow {
        display: inline-block;
        transition: transform var(--transition-base);
      }

      .featured__link:hover .featured__link-arrow {
        transform: translateX(4px);
      }

      .archive {
        margin-bottom: var(--space-4xl);
      }

      .archive__header {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        margin-bottom: var(--space-3xl);
        padding-bottom: var(--space-lg);
        border-bottom: 3px solid rgb(var(--black));
      }

      .archive__title {
        font-size: var(--text-3xl);
        font-weight: 900;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: -0.02em;
      }

      .archive__count {
        font-size: var(--text-md);
        font-weight: 700;
        color: rgb(var(--white));
        background: rgb(var(--black));
        padding: var(--space-xs) var(--space-md);
        border-radius: 100px;
      }

      .posts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: var(--space-2xl);
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .post-card {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
        padding: var(--space-xl);
        background: rgb(var(--white));
        border: 3px solid rgb(var(--black));
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
      }

      .post-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: var(--accent);
        transform: scaleY(0);
        transform-origin: bottom;
        transition: transform var(--transition-base);
      }

      .post-card:hover::before {
        transform: scaleY(1);
        transform-origin: top;
      }

      .post-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
      }

      .post-card__tag {
        font-size: var(--text-xs);
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--accent);
        background: rgba(255, 51, 102, 0.1);
        padding: 0.25rem 0.75rem;
        align-self: flex-start;
        border: 2px solid var(--accent);
      }

      .post-card__title {
        font-size: var(--text-xl);
        font-weight: 800;
        line-height: 1.2;
        margin: 0;
        color: rgb(var(--black));
        letter-spacing: -0.02em;
        transition: color var(--transition-fast);
      }

      .post-card__link {
        text-decoration: none;
        border: none;
      }

      .post-card__link:hover {
        background: transparent;
      }

      .post-card__link:hover .post-card__title {
        color: var(--accent);
      }

      .post-card__date {
        font-size: var(--text-xs);
        color: rgb(var(--gray));
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0;
      }

      .post-card__description {
        font-size: var(--text-sm);
        line-height: 1.6;
        color: rgb(var(--gray-dark));
        margin: 0;
      }

      @media (max-width: 768px) {
        .hero {
          padding: var(--space-2xl) 0;
          margin-bottom: var(--space-3xl);
        }

        .hero__title {
          font-size: var(--text-3xl);
        }

        .hero__subtitle {
          font-size: var(--text-md);
        }

        .featured__card {
          padding: var(--space-xl);
          gap: var(--space-lg);
        }

        .featured__title {
          font-size: var(--text-2xl);
        }

        .posts-grid {
          grid-template-columns: 1fr;
          gap: var(--space-lg);
        }

        .archive__title {
          font-size: var(--text-xl);
        }
      }
    </style>
	</head>
	<body>
		<Header />
		<main>
        <section class="hero">
          <h1 class="hero__title">Frontend Weekly</h1>
          <p class="hero__subtitle">Еженедельный дайджест самых важных новостей из мира фронтенд-разработки</p>
        </section>

        {featuredPost && (
          <section class="featured">
            <span class="featured__label">Последний выпуск</span>
            <article class="featured__card">
              <div class="featured__content">
                <time class="featured__date">
                  {new Date(featuredPost.data.pubDate).toLocaleDateString('ru-RU', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                  })}
                </time>
                <h2 class="featured__title" transition:name={`title-${featuredPost.slug}`}>
                  {featuredPost.data.title}
                </h2>
                <p class="featured__description">{featuredPost.data.description}</p>
                <a href={`/${featuredPost.slug}/`} class="featured__link">
                  Читать выпуск
                  <span class="featured__link-arrow">→</span>
                </a>
              </div>
            </article>
          </section>
        )}

        <section class="archive">
          <div class="archive__header">
            <h2 class="archive__title">Архив</h2>
            <span class="archive__count">{otherPosts.length}</span>
          </div>
          <ul class="posts-grid">
            {otherPosts.map((post) => (
              <li class="post-card">
                <span class="post-card__tag">Дайджест</span>
                <a href={`/${post.slug}/`} class="post-card__link">
                  <h3 class="post-card__title" transition:name={`title-${post.slug}`}>
                    {post.data.title}
                  </h3>
                </a>
                <time class="post-card__date">
                  {new Date(post.data.pubDate).toLocaleDateString('ru-RU', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric' 
                  })}
                </time>
                <p class="post-card__description">{post.data.description}</p>
              </li>
            ))}
          </ul>
        </section>
		</main>
		<Footer />
	</body>
</html>
