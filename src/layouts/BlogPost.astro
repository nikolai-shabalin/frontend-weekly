---
import type {CollectionEntry} from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import DigestRecommendations from '../components/DigestRecommendations.astro';
import DigestBanner from '../components/DigestBanner.astro';
import FrontieMascot from '../components/FrontieMascot.astro';
import { banners } from '../data/banners';

type Props = CollectionEntry<'digest'>['data'] & {
  slug?: string;
  mascotMessages?: import('../types/mascot').MascotMessage[];
};

const {title, description, pubDate, slug = '', mascotMessages = []} = Astro.props;
---

<html lang="ru">
<head>
  <BaseHead title={title} description={description}/>
  <style>
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      margin-bottom: var(--space-2xl);
      font-size: var(--text-sm);
      font-weight: 700;
      color: rgb(var(--gray-dark));
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border: none;
      padding: var(--space-sm) 0;
      transition: all var(--transition-base);
    }

    .back-link:hover {
      color: var(--accent);
      background: transparent;
      transform: translateX(-4px);
    }

    .back-link-arrow {
      transition: transform var(--transition-base);
    }

    .back-link:hover .back-link-arrow {
      transform: translateX(-4px);
    }

    .post-header {
      text-align: left;
      margin-bottom: var(--space-4xl);
      padding-bottom: var(--space-3xl);
      border-bottom: 4px solid rgb(var(--black));
      position: relative;
    }

    .post-header::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 120px;
      height: 4px;
      background: var(--accent);
    }

    .post__meta {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-xl);
    }

    .post__tag {
      display: inline-block;
      font-size: var(--text-xs);
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: rgb(var(--white));
      background: rgb(var(--black));
      padding: var(--space-xs) var(--space-md);
      border: 3px solid rgb(var(--black));
      box-shadow: 3px 3px 0 var(--accent);
    }

    .post :global(time) {
      font-size: var(--text-sm);
      color: rgb(var(--gray));
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .post__title {
      font-size: var(--text-4xl);
      line-height: 0.95;
      margin: 0 0 var(--space-lg) 0;
      font-weight: 900;
      letter-spacing: -0.04em;
      text-transform: none;
      max-width: 20ch;
    }

    .post__description {
      font-size: var(--text-lg);
      line-height: 1.6;
      color: rgb(var(--gray-dark));
      max-width: 60ch;
      margin: 0;
    }

    .content {
      max-width: var(--content-width-narrow);
      margin: 0 auto;
    }

    /* Улучшенная типографика контента */
    .content :global(h2) {
      font-size: var(--text-3xl);
      font-weight: 900;
      margin-top: var(--space-4xl);
      margin-bottom: var(--space-xl);
      padding-top: var(--space-xl);
      border-top: 3px solid rgb(var(--black));
      position: relative;
      letter-spacing: -0.03em;
    }

    .content :global(h2)::before {
      content: '';
      position: absolute;
      top: -3px;
      left: 0;
      width: 80px;
      height: 3px;
      background: var(--accent);
    }

    .content :global(h3) {
      font-size: var(--text-2xl);
      font-weight: 800;
      margin-top: var(--space-3xl);
      margin-bottom: var(--space-lg);
      letter-spacing: -0.02em;
      color: rgb(var(--black));
      position: relative;
      padding-left: var(--space-md);
    }

    .content :global(h3)::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0.3em;
      width: 4px;
      height: 1.2em;
      background: var(--accent);
    }

    .content :global(h4) {
      font-size: var(--text-xl);
      font-weight: 700;
      margin-top: var(--space-2xl);
      margin-bottom: var(--space-md);
    }

    .content :global(p) {
      font-size: var(--text-base);
      line-height: 1.8;
      margin-bottom: var(--space-xl);
      text-wrap: pretty;
      color: rgb(var(--gray-dark));
    }

    .content :global(p strong) {
      color: rgb(var(--black));
      font-weight: 700;
    }

    .content :global(ul),
    .content :global(ol) {
      margin-bottom: var(--space-2xl);
      padding-left: var(--space-2xl);
    }

    .content :global(li) {
      margin-bottom: var(--space-md);
      padding-left: var(--space-sm);
    }

    .content :global(li::marker) {
      color: var(--accent);
      font-weight: 700;
    }

    .content :global(a) {
      color: var(--accent);
      font-weight: 600;
      border-bottom: 2px solid var(--accent);
      transition: all var(--transition-fast);
    }

    .content :global(a:hover) {
      color: var(--accent-dark);
      background: rgba(255, 51, 102, 0.1);
      border-bottom-color: var(--accent-dark);
    }

    .content :global(code) {
      font-family: var(--font-mono);
      font-size: 0.9em;
      background: rgba(var(--gray-light), 0.8);
      border: 2px solid rgb(var(--gray-medium));
      padding: 0.2em 0.5em;
      border-radius: 3px;
      font-weight: 600;
    }

    .content :global(pre) {
      background: rgb(var(--gray-dark));
      color: rgb(var(--white));
      padding: var(--space-xl);
      margin: var(--space-2xl) 0;
      overflow-x: auto;
      border: 3px solid rgb(var(--black));
      box-shadow: var(--shadow-brutal);
    }

    .content :global(pre code) {
      background: transparent;
      border: none;
      color: rgb(var(--white));
      padding: 0;
    }

    .content :global(blockquote) {
      font-size: var(--text-lg);
      line-height: 1.7;
      font-style: italic;
      color: rgb(var(--gray-dark));
      background: rgb(var(--gray-light));
      padding: var(--space-xl) var(--space-2xl);
      margin: var(--space-2xl) 0;
      border-left: 6px solid var(--accent);
      position: relative;
    }

    .content :global(blockquote::before) {
      content: '"';
      position: absolute;
      top: -0.2em;
      left: var(--space-md);
      font-size: var(--text-4xl);
      color: var(--accent);
      font-family: Georgia, serif;
      line-height: 1;
      font-weight: 700;
    }

    .content :global(blockquote p:last-child) {
      margin-bottom: 0;
    }

    .content :global(img) {
      margin: var(--space-2xl) 0;
      border: 4px solid rgb(var(--black));
      box-shadow: var(--shadow-brutal);
    }

    .content :global(figure) {
      margin: var(--space-3xl) 0;
    }

    .content :global(figcaption) {
      font-size: var(--text-sm);
      color: rgb(var(--gray));
      text-align: center;
      margin-top: var(--space-md);
      font-style: italic;
    }

    .content :global(hr) {
      border: none;
      border-top: 3px solid rgb(var(--black));
      margin: var(--space-4xl) 0;
      position: relative;
    }

    .content :global(hr)::after {
      content: '';
      position: absolute;
      top: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--accent);
    }

    .content :global(table) {
      width: 100%;
      margin: var(--space-2xl) 0;
      border: 3px solid rgb(var(--black));
      border-collapse: collapse;
    }

    .content :global(th),
    .content :global(td) {
      padding: var(--space-md);
      border: 1px solid rgb(var(--black));
      text-align: left;
    }

    .content :global(th) {
      background: rgb(var(--black));
      color: rgb(var(--white));
      font-weight: 700;
      text-transform: uppercase;
      font-size: var(--text-sm);
      letter-spacing: 0.05em;
    }

    @media (max-width: 768px) {
      .post__title {
        font-size: var(--text-3xl);
      }

      .content :global(h2) {
        font-size: var(--text-2xl);
      }

      .content :global(h3) {
        font-size: var(--text-xl);
      }
    }
  </style>
</head>

<body>
<Header />
<main>
  <article class="post">
    <a href="/" class="back-link">
      <span class="back-link-arrow">←</span>
      На главную
    </a>

    <header class="post-header">
      <div class="post__meta">
        <span class="post__tag">Дайджест</span>
        <FormattedDate date={pubDate}/>
      </div>
      <h1 class="post__title" transition:name={`title-${slug}`}>{title}</h1>
      <p class="post__description">{description}</p>
    </header>

    <DigestBanner banners={banners} />
    <DigestRecommendations />
    <FrontieMascot messages={mascotMessages} />

    <div class="content">
      <slot/>
    </div>
  </article>
</main>
<Footer/>
</body>
</html>
